[CODIGO CLAVE: Sistema de Puntuación]

// src/stores/userProgress.js
visitNode(storyId, nodeId) {
    if (!this.currentSessionNodes) this.currentSessionNodes = new Set();
    this.currentSessionNodes.add(nodeId);
    if (!this.state.visitedNodes[storyId].has(nodeId)) {
        this.state.visitedNodes[storyId].add(nodeId);
        this.state.points += 5; // +5 Puntos por nodo nuevo
    }
}

reachEnding(storyId, endingId, totalEndings, totalStoryNodes = 0) {
    // Bonus por Ruta (Línea)
    const sessionLength = this.currentSessionNodes ? this.currentSessionNodes.size : 0;
    const routeBonus = sessionLength * 50;
    this.state.points += routeBonus;

    if (this.state.unlockedRoutes[storyId].size >= totalEndings) {
        // Bonus 100%
        const totalNodes = totalStoryNodes || this.state.visitedNodes[storyId].size;
        this.state.points += totalNodes * 100;
    }
}

// src/engine/StoryEngine.js
const handleChoice = useCallback(async (targetNodeId) => {
    // ...
    userProgress.visitNode(seriesId, targetNodeId);
    
    // Auto-detect ending
    const isEnding = !nextNode.choices || nextNode.choices.every(c => c.action === 'EXIT');
    if (isEnding) {
        userProgress.reachEnding(seriesId, targetNodeId, totalEndings, totalNodes);
    }
});
