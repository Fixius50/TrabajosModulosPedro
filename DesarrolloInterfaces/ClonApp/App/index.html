<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notion Clone V56 - Multi-Workspace</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'], mono: ['JetBrains Mono', 'monospace'] },
                    colors: { 
                        zinc: { 850: '#1f1f22', 900: '#18181b', 950: '#09090b' },
                        notion: { hover: '#EFEFEE', select: '#E8F3FF', text: '#37352f' }
                    }
                }
            }
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400&display=swap');
        body { background-color: #FBFBFA; color: #37352f; }
        
        .fancy-scroll::-webkit-scrollbar { width: 10px; height: 10px; }
        .fancy-scroll::-webkit-scrollbar-track { background: transparent; }
        .fancy-scroll::-webkit-scrollbar-thumb { background: #D3D1CB; border-radius: 5px; border: 2px solid #FBFBFA; }
        .fancy-scroll::-webkit-scrollbar-thumb:hover { background: #AEACA6; }
        
        [contenteditable]:empty:before { content: attr(placeholder); color: #9B9A97; pointer-events: none; display: block; }
        
        .animate-spin-slow { animation: spin 3s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>

    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client?deps=react@18.2.0",
            "framer-motion": "https://esm.sh/framer-motion@10.16.4?deps=react@18.2.0,react-dom@18.2.0",
            "lucide-react": "https://esm.sh/lucide-react@0.263.1?deps=react@18.2.0"
        }
    }
    </script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module" data-presets="react">
        import React, { useState, useEffect, useRef, useLayoutEffect, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { motion, AnimatePresence } from 'framer-motion';
        import { 
            List, Plus, Trash, Image as ImageIcon, FileText, 
            MoreHorizontal, Search, Settings, GripVertical, 
            ArrowRight, CheckSquare, Sparkles, Sidebar as SidebarIcon,
            X, Github, Palette, Type, Globe, Lock, ChevronDown, Check,
            Users, Inbox, ArrowLeft, SlidersHorizontal, User, Briefcase, Plane, Music,
            Wand2, Loader2, LayoutTemplate, Bell, ChevronsLeft, CreditCard, LogOut,
            ChevronRight, UploadCloud, Command, FolderOpen, Camera, PlusCircle
        } from 'lucide-react';

        // --- ENDPOINTS ---
        const API_MARKET = "/api/market";
        const API_AI = "/api/generar-pagina";
        const API_UPLOAD = "/api/upload";

        // Datos Iniciales
        const generateId = () => Math.random().toString(36).substr(2, 9);
        const ICONS_LIST = ['üìÑ', 'üéµ', 'üöÄ', 'üíº', 'üí°', 'üé®', 'üèà', 'ü™ê', 'üçé', 'üçï', '‚öΩ', 'üöó', 'üê∂', 'üê±', 'üéâ', 'üìö', 'üí∏', 'üè†', '‚ù§Ô∏è', 'üíÄ', 'üî•', '‚ú®'];
        const INITIAL_WORKSPACES = [{ id: 'ws-demo', name: 'Fixius Workspace', initial: 'F', color: 'from-indigo-500 to-purple-500', email: 'user@example.com', pages: [] }];
        const INITIAL_PROFILE = { name: "Usuario Fixius", email: "usuario@ejemplo.com", bio: "Apasionado de la productividad.", avatar: null };

        // Helper para colores aleatorios de workspace
        const getRandomColor = () => {
            const colors = [
                'from-indigo-500 to-purple-500',
                'from-pink-500 to-rose-500',
                'from-emerald-500 to-teal-500',
                'from-blue-500 to-cyan-500',
                'from-orange-500 to-amber-500'
            ];
            return colors[Math.floor(Math.random() * colors.length)];
        };

        // --- UI COMPONENTS ---
        const NotificationPopup = ({ message, onClose, isVisible }) => (
            <AnimatePresence>
                {isVisible && (
                    <motion.div 
                        initial={{ opacity: 0, y: 20, scale: 0.95 }} 
                        animate={{ opacity: 1, y: 0, scale: 1 }} 
                        exit={{ opacity: 0, y: 20, scale: 0.95 }} 
                        className="fixed bottom-6 right-6 bg-[#2C2C2C] text-white py-3 px-4 rounded-lg shadow-2xl flex items-center gap-3 z-[100] max-w-sm cursor-pointer border border-white/10 hover:bg-[#3F3F3F] transition-colors" 
                        onClick={onClose}
                    >
                        <div className="bg-blue-500/20 p-1 rounded text-blue-400"><Check size={16}/></div>
                        <div className="flex-1 text-sm font-medium">{message}</div>
                    </motion.div>
                )}
            </AnimatePresence>
        );

        const FancyEditable = ({ tagName: Tag, html, className, onChange, onKeyDown, placeholder, disabled, autoFocus }) => {
            const contentEditableRef = useRef(null);
            useEffect(() => { if (autoFocus && contentEditableRef.current) contentEditableRef.current.focus(); }, [autoFocus]);
            useLayoutEffect(() => { if (contentEditableRef.current && contentEditableRef.current.innerText !== html) contentEditableRef.current.innerText = html; }, [html]);
            const handleInput = (e) => { if (onChange && e.currentTarget.innerText !== html) onChange(e.currentTarget.innerText); };
            return <Tag ref={contentEditableRef} className={`${className} empty:before:content-[attr(placeholder)] empty:before:text-zinc-300 outline-none`} contentEditable={!disabled} suppressContentEditableWarning onInput={handleInput} onKeyDown={onKeyDown} placeholder={placeholder} />;
        };

        const Modal = ({ isOpen, onClose, children, title, size = "max-w-2xl", transparent = false }) => (
            <AnimatePresence>
                {isOpen && (
                    <>
                        <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }} onClick={onClose} className="fixed inset-0 bg-black/30 backdrop-blur-[2px] z-50" />
                        <motion.div initial={{ opacity: 0, scale: 0.98, y: 10 }} animate={{ opacity: 1, scale: 1, y: 0 }} exit={{ opacity: 0, scale: 0.98, y: 10 }} className={`fixed inset-0 m-auto ${size} h-fit max-h-[85vh] ${transparent ? 'bg-transparent shadow-none' : 'bg-white shadow-2xl border border-zinc-200'} rounded-xl z-50 overflow-hidden flex flex-col text-zinc-800`}>
                            {title !== null && !transparent && (<div className="flex justify-between items-center p-4 border-b border-zinc-100 shrink-0"><h2 className="text-sm font-semibold text-zinc-700">{title}</h2><button onClick={onClose} className="p-1 hover:bg-zinc-100 rounded text-zinc-400 hover:text-zinc-600 transition-colors"><X size={18}/></button></div>)}
                            <div className="flex-1 overflow-y-auto">{children}</div>
                        </motion.div>
                    </>
                )}
            </AnimatePresence>
        );

        const EditorBlock = ({ block, index, updateBlock, addBlock, deleteBlock }) => {
            const handleKeyDown = (e) => { if (e.key === 'Enter') { e.preventDefault(); addBlock(index + 1); } else if (e.key === 'Backspace' && (!block.content)) { e.preventDefault(); deleteBlock(index); } };
            const handleChange = (val) => {
                if (block.type === 'p') {
                    if (val === '# ') { updateBlock(block.id, { type: 'h1', content: '' }); return; }
                    if (val === '## ') { updateBlock(block.id, { type: 'h2', content: '' }); return; }
                    if (val === '### ') { updateBlock(block.id, { type: 'h3', content: '' }); return; }
                    if (val === '- ') { updateBlock(block.id, { type: 'bullet', content: '' }); return; }
                    if (val === '[] ') { updateBlock(block.id, { type: 'todo', content: '' }); return; }
                }
                updateBlock(block.id, { content: val });
            };
            return (
                <motion.div layout className="group relative flex items-start pl-2 md:pl-6 mb-1 py-0.5">
                    <div className="absolute left-0 top-1.5 p-0.5 text-zinc-300 opacity-0 group-hover:opacity-100 cursor-grab active:cursor-grabbing hover:text-zinc-500 transition-opacity"><GripVertical size={14} /></div>
                    <div className="w-full">
                        {block.type === 'h1' && <FancyEditable tagName="h1" html={block.content} className="text-3xl font-bold text-zinc-800 mb-2 mt-6" placeholder="Encabezado 1" onKeyDown={handleKeyDown} onChange={handleChange} autoFocus />}
                        {block.type === 'h2' && <FancyEditable tagName="h2" html={block.content} className="text-2xl font-semibold text-zinc-800 mb-1 mt-4" placeholder="Encabezado 2" onKeyDown={handleKeyDown} onChange={handleChange} autoFocus />}
                        {block.type === 'h3' && <FancyEditable tagName="h3" html={block.content} className="text-xl font-semibold text-zinc-800 mb-1 mt-3" placeholder="Encabezado 3" onKeyDown={handleKeyDown} onChange={handleChange} autoFocus />}
                        {block.type === 'p' && <FancyEditable tagName="p" html={block.content} className="text-base text-zinc-700 leading-relaxed min-h-[24px]" placeholder='Escribe "/" para comandos...' onKeyDown={handleKeyDown} onChange={handleChange} autoFocus />}
                        {block.type === 'bullet' && <div className="flex items-start gap-2"><div className="mt-2.5 w-1.5 h-1.5 rounded-full bg-zinc-800 shrink-0"/><FancyEditable tagName="p" html={block.content} className="flex-1 text-base text-zinc-700 leading-relaxed" placeholder="Lista" onKeyDown={handleKeyDown} onChange={(val) => updateBlock(block.id, { content: val })} autoFocus /></div>}
                        {block.type === 'todo' && <div className="flex items-start gap-3"><div onClick={() => updateBlock(block.id, { checked: !block.checked })} className={`mt-1 w-4 h-4 rounded-[3px] border cursor-pointer flex items-center justify-center transition-colors ${block.checked ? 'bg-[#2EAADC] border-[#2EAADC]' : 'border-zinc-400 hover:bg-zinc-100'}`}>{block.checked && <Check size={12} className="text-white" />}</div><FancyEditable tagName="p" html={block.content} className={`flex-1 text-base min-h-[24px] transition-opacity ${block.checked ? 'line-through text-zinc-400 opacity-50' : 'text-zinc-700'}`} placeholder="Tarea por hacer" onKeyDown={handleKeyDown} onChange={(val) => updateBlock(block.id, { content: val })} autoFocus /></div>}
                    </div>
                </motion.div>
            );
        };

        const SpotlightCard = ({ children, className = "", onClick }) => {
            const divRef = useRef(null);
            const [position, setPosition] = useState({ x: 0, y: 0 });
            const [opacity, setOpacity] = useState(0);
            const handleMouseMove = (e) => { if (!divRef.current) return; const rect = divRef.current.getBoundingClientRect(); setPosition({ x: e.clientX - rect.left, y: e.clientY - rect.top }); };
            return (
                <motion.div ref={divRef} onMouseMove={handleMouseMove} onMouseEnter={() => setOpacity(1)} onMouseLeave={() => setOpacity(0)} onClick={onClick} className={`relative rounded-xl border border-zinc-200 bg-white shadow-sm overflow-hidden cursor-pointer group ${className}`} whileHover={{ y: -2 }} whileTap={{ scale: 0.99 }}>
                    <div className="pointer-events-none absolute -inset-px opacity-0 transition duration-300 z-10" style={{ opacity, background: `radial-gradient(600px circle at ${position.x}px ${position.y}px, rgba(0,0,0,0.05), transparent 40%)` }} />
                    <div className="relative h-full z-0">{children}</div>
                </motion.div>
            );
        };

        // --- APP PRINCIPAL ---
        function App() {
            const [workspaces, setWorkspaces] = useState(() => { const saved = localStorage.getItem('notion_v56_workspaces'); return saved ? JSON.parse(saved) : INITIAL_WORKSPACES; });
            const [userProfile, setUserProfile] = useState(() => { const saved = localStorage.getItem('notion_v56_profile'); return saved ? JSON.parse(saved) : INITIAL_PROFILE; });
            
            const [sidebarOpen, setSidebarOpen] = useState(true);
            const [currentView, setCurrentView] = useState('home'); 
            const [settingsTab, setSettingsTab] = useState('menu'); 
            const [activeWorkspaceId, setActiveWorkspaceId] = useState(() => { return localStorage.getItem('notion_active_ws') || 'ws-demo' });
            const [activePageId, setActivePageId] = useState(null);
            
            const [importedResources, setImportedResources] = useState({ styles: [], fonts: [] });
            const [installedIds, setInstalledIds] = useState(new Set()); 
            
            const [notification, setNotification] = useState({ show: false, message: '' });
            const [showSearch, setShowSearch] = useState(false);
            const [showMarket, setShowMarket] = useState(false);
            const [marketTab, setMarketTab] = useState('gallery');
            const [showWorkspaceMenu, setShowWorkspaceMenu] = useState(false);
            const [showIconPicker, setShowIconPicker] = useState(false);
            const [showPageOptions, setShowPageOptions] = useState(false);
            const [showAI, setShowAI] = useState(false); 
            const [aiPrompt, setAiPrompt] = useState("");
            const [isAiGeneratingBackground, setIsAiGeneratingBackground] = useState(false);
            const [searchQuery, setSearchQuery] = useState('');
            const [marketData, setMarketData] = useState({ styles: [], fonts: [], covers: [] });
            const [isLoadingMarket, setIsLoadingMarket] = useState(false);
            
            const [uploadContext, setUploadContext] = useState(null);
            const fileInputRef = useRef(null);

            // Asegurarse de que el workspace activo existe (si no, usar el primero)
            const workspace = useMemo(() => {
                return workspaces.find(w => w.id === activeWorkspaceId) || workspaces[0];
            }, [workspaces, activeWorkspaceId]);

            const activePage = workspace?.pages.find(p => p.id === activePageId);
            
            const filteredPages = useMemo(() => {
                if (!workspace) return [];
                if (!searchQuery.trim()) return workspace.pages;
                return workspace.pages.filter(p => p.title.toLowerCase().includes(searchQuery.toLowerCase()));
            }, [searchQuery, workspace]);

            useEffect(() => { localStorage.setItem('notion_v56_workspaces', JSON.stringify(workspaces)); }, [workspaces]);
            useEffect(() => { localStorage.setItem('notion_active_ws', activeWorkspaceId); }, [activeWorkspaceId]);
            useEffect(() => { localStorage.setItem('notion_v56_profile', JSON.stringify(userProfile)); }, [userProfile]);
            useEffect(() => { if (notification.show) { const timer = setTimeout(() => setNotification({ ...notification, show: false }), 4000); return () => clearTimeout(timer); } }, [notification.show]);

            // --- WORKSPACE MANAGEMENT ---
            const createWorkspace = () => {
                const name = prompt("Nombre del nuevo espacio de trabajo:");
                if (!name || !name.trim()) return;
                
                const newWorkspace = {
                    id: generateId(),
                    name: name.trim(),
                    initial: name.trim().charAt(0).toUpperCase(),
                    color: getRandomColor(),
                    email: userProfile.email,
                    pages: []
                };
                
                setWorkspaces(prev => [...prev, newWorkspace]);
                setActiveWorkspaceId(newWorkspace.id);
                setNotification({ show: true, message: `Espacio "${newWorkspace.name}" creado` });
                setShowWorkspaceMenu(false);
            };

            const deleteWorkspace = (e, id) => {
                e.stopPropagation();
                if (workspaces.length <= 1) {
                    alert("No puedes eliminar el √∫ltimo espacio de trabajo.");
                    return;
                }
                
                if (confirm("¬øEst√°s seguro? Se borrar√°n todas las p√°ginas de este espacio.")) {
                    const newWorkspaces = workspaces.filter(w => w.id !== id);
                    setWorkspaces(newWorkspaces);
                    
                    // Si borramos el activo, cambiamos al primero disponible
                    if (activeWorkspaceId === id) {
                        setActiveWorkspaceId(newWorkspaces[0].id);
                        setCurrentView('home');
                    }
                    setNotification({ show: true, message: "Espacio eliminado" });
                }
            };

            // --- FETCH MARKET ---
            const fetchMarketData = async () => {
                setIsLoadingMarket(true);
                try {
                    const response = await fetch(API_MARKET); 
                    if (!response.ok) throw new Error('Market API Error');
                    const data = await response.json();
                    const fetchedCovers = data.covers ? Object.values(data.covers).flat() : [];
                    setMarketData({ styles: data.styles || [], fonts: data.fonts || [], covers: fetchedCovers });
                } catch (e) { 
                    console.warn("Market fetch failed");
                    setMarketData({ styles: [], fonts: [], covers: [] }); 
                } finally { setIsLoadingMarket(false); }
            };

            const importResource = (resource, type) => {
                if (installedIds.has(resource.id)) return;
                if (type === 'style') {
                    setImportedResources(prev => ({ ...prev, styles: [...prev.styles, resource] }));
                    setNotification({ show: true, message: `Tema "${resource.name}" a√±adido` });
                } else if (type === 'font') {
                    setImportedResources(prev => ({ ...prev, fonts: [...prev.fonts, resource] }));
                    setNotification({ show: true, message: `Fuente "${resource.name}" a√±adida` });
                }
                setInstalledIds(prev => new Set(prev).add(resource.id));
            };

            const triggerUpload = (context) => {
                setUploadContext(context);
                if (fileInputRef.current) fileInputRef.current.click();
            };

            const handleFileUpload = async (event) => {
                const file = event.target.files[0];
                if (!file) return;
                
                setNotification({ show: true, message: "Subiendo..." });

                try {
                    let fileUrl;
                    const response = await fetch(`${API_UPLOAD}?filename=${encodeURIComponent(file.name)}`, { method: 'POST', body: file });
                    if (response.ok) { const blob = await response.json(); fileUrl = blob.url; } 
                    else { fileUrl = URL.createObjectURL(file); }
                    
                    if (uploadContext === 'cover') {
                        if (activePageId) updatePage(activePageId, { cover: fileUrl });
                        setNotification({ show: true, message: "Portada actualizada" });
                        setShowMarket(false);
                    } else if (uploadContext === 'avatar') {
                        setUserProfile(prev => ({ ...prev, avatar: fileUrl }));
                        setNotification({ show: true, message: "Foto de perfil actualizada" });
                    } else if (uploadContext === 'style') {
                        const newStyle = { id: generateId(), name: file.name.split('.')[0], author: 'Local', color: 'bg-gray-100' };
                        importResource(newStyle, 'style');
                    } else if (uploadContext === 'font') {
                        const newFont = { id: generateId(), name: file.name.split('.')[0], type: 'local' };
                        importResource(newFont, 'font');
                    }

                } catch (error) {
                    console.error(error);
                    setNotification({ show: true, message: "Error subiendo archivo" });
                } finally { 
                    setUploadContext(null); 
                    event.target.value = ''; 
                }
            };

            // --- IA GENERATION CON FALLBACK (FIX PARA API ERROR) ---
            const generatePageWithAI = async () => {
                if (!aiPrompt.trim()) return;
                setShowAI(false);
                setAiPrompt("");
                setIsAiGeneratingBackground(true);
                
                try {
                    // Intento de llamada a API Real
                    const response = await fetch(API_AI, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ prompt: `Generate notion page for: ${aiPrompt}` })
                    });
                    
                    let parsed;
                    
                    // Si la respuesta no es OK (ej: 404, 500, o URL inv√°lida en canvas), lanzamos error para caer en el catch
                    if(!response.ok) throw new Error("API Failed");
                    
                    parsed = await response.json();
                    
                    // Si llegamos aqu√≠, la API funcion√≥. Procesamos:
                    createPageFromData(parsed);

                } catch (e) { 
                    console.warn("AI Fallback activado (Modo Canvas/Offline):", e);
                    // FALLBACK: Simulaci√≥n local para que no te quedes trabado
                    await new Promise(r => setTimeout(r, 2000));
                    const mockParsed = { 
                        title: aiPrompt, 
                        icon: "ü§ñ", 
                        cover_keyword: "technology", 
                        blocks: [
                            {type: "h1", content: "Resumen (Modo Offline)"}, 
                            {type: "p", content: "La IA no pudo conectarse, pero aqu√≠ tienes tu p√°gina lista para editar."},
                            {type: "todo", content: "Revisar conexi√≥n API"},
                            {type: "todo", content: "Empezar a escribir"}
                        ] 
                    };
                    createPageFromData(mockParsed);
                } finally { 
                    setIsAiGeneratingBackground(false); 
                }
            };

            const createPageFromData = (parsed) => {
                const keyword = parsed.cover_keyword || "abstract";
                const dynamicCover = `https://image.pollinations.ai/prompt/${encodeURIComponent(keyword)}?width=1200&height=400&nologo=true`;
                const newPage = { id: generateId(), title: parsed.title, icon: parsed.icon || '‚ú®', cover: dynamicCover, updatedAt: new Date().toISOString(), isPrivate: true, blocks: parsed.blocks?.map(b => ({ ...b, id: generateId() })) || [] };
                
                const updated = workspaces.map(ws => ws.id === activeWorkspaceId ? { ...ws, pages: [...ws.pages, newPage] } : ws);
                setWorkspaces(updated);
                setNotification({ show: true, message: `"${newPage.title}" creada.` });
            };

            useEffect(() => { if(showMarket) fetchMarketData(); }, [showMarket]);

            const updatePage = (pid, u) => setWorkspaces(workspaces.map(ws => ws.id === activeWorkspaceId ? { ...ws, pages: ws.pages.map(p => p.id === pid ? { ...p, ...u } : p) } : ws));
            const createPage = () => { const id = generateId(); const np = { id, title: '', icon: null, cover: null, isPrivate: true, updatedAt: new Date().toISOString(), blocks: [{ id: generateId(), type: 'p', content: '' }] }; setWorkspaces(workspaces.map(ws => ws.id === activeWorkspaceId ? { ...ws, pages: [...ws.pages, np] } : ws)); setActivePageId(id); setCurrentView('page'); };
            const deletePage = (id) => { if(confirm("¬øEliminar?")) { setWorkspaces(workspaces.map(ws => ws.id === activeWorkspaceId ? { ...ws, pages: ws.pages.filter(p => p.id !== id) } : ws)); if(activePageId === id) { setActivePageId(null); setCurrentView('home'); } } };
            const updateBlock = (bid, u) => updatePage(activePageId, { blocks: activePage.blocks.map(b => b.id === bid ? { ...b, ...u } : b) });
            const addBlock = (idx) => { const bs = [...activePage.blocks]; bs.splice(idx, 0, { id: generateId(), type: 'p', content: '' }); updatePage(activePageId, { blocks: bs }); };
            const deleteBlock = (idx) => { const bs = [...activePage.blocks]; bs.splice(idx, 1); updatePage(activePageId, { blocks: bs }); };

            if (!workspace) return null; // Prevenir renderizado si no hay workspace

            return (
                <div className="flex h-screen w-full bg-[#FBFBFA] text-[#37352f] font-sans selection:bg-[#cce9ff] relative">
                    <NotificationPopup message={notification.message} isVisible={notification.show} onClose={() => setNotification({ ...notification, show: false })} />
                    
                    <input type="file" ref={fileInputRef} className="hidden" onChange={handleFileUpload} />

                    <motion.aside initial={false} animate={{ width: sidebarOpen ? 240 : 56 }} className="h-full bg-[#F7F7F5] flex flex-col z-20 relative border-r border-[#E9E9E8] overflow-hidden transition-all duration-300 group/sidebar">
                        
                        {/* HEADER WORKSPACE (DROPDOWN) */}
                        <div className="p-3 relative shrink-0">
                            <div onClick={() => setShowWorkspaceMenu(!showWorkspaceMenu)} className={`flex items-center gap-2 p-1.5 rounded-md hover:bg-[#EFEFEE] transition-colors cursor-pointer ${!sidebarOpen ? 'justify-start pl-1' : ''} relative z-20`}>
                                <div className={`w-5 h-5 rounded-[3px] bg-gradient-to-br ${workspace.color} flex items-center justify-center text-white text-[10px] font-bold shadow-sm shrink-0`}>{workspace.initial}</div>
                                {sidebarOpen && <><div className="flex-1 overflow-hidden text-sm font-medium truncate text-[#37352f]">{workspace.name}</div><ChevronDown size={12} className="text-zinc-400"/></>}
                            </div>

                            {/* MEN√ö DE WORKSPACES MEJORADO */}
                            <AnimatePresence>
                                {showWorkspaceMenu && sidebarOpen && (
                                    <>
                                        <div className="fixed inset-0 z-10" onClick={() => setShowWorkspaceMenu(false)}/>
                                        <motion.div 
                                            initial={{ opacity: 0, y: -10 }} 
                                            animate={{ opacity: 1, y: 0 }} 
                                            exit={{ opacity: 0, y: -10 }} 
                                            className="absolute top-12 left-2 right-2 bg-white border border-zinc-200 rounded-lg shadow-xl z-20 overflow-hidden"
                                        >
                                            <div className="p-2 border-b border-zinc-100 bg-zinc-50/50"><span className="text-[10px] font-bold text-zinc-400 uppercase px-2">Tus Espacios</span></div>
                                            <div className="max-h-48 overflow-y-auto">
                                                {workspaces.map(ws => (
                                                    <div key={ws.id} onClick={() => { setActiveWorkspaceId(ws.id); setShowWorkspaceMenu(false); setCurrentView('home'); }} className="flex items-center gap-2 p-2 hover:bg-zinc-100 cursor-pointer text-sm group/ws">
                                                        <div className={`w-5 h-5 rounded-[3px] bg-gradient-to-br ${ws.color} text-white flex items-center justify-center text-[10px]`}>{ws.initial}</div>
                                                        <span className={`flex-1 truncate ${ws.id === activeWorkspaceId ? 'font-medium' : ''}`}>{ws.name}</span>
                                                        {ws.id === activeWorkspaceId && <Check size={14} className="text-indigo-600"/>}
                                                        {ws.id !== activeWorkspaceId && (
                                                            <button 
                                                                onClick={(e) => deleteWorkspace(e, ws.id)}
                                                                className="opacity-0 group-hover/ws:opacity-100 p-1 hover:bg-red-100 text-zinc-400 hover:text-red-500 rounded transition-all"
                                                            >
                                                                <Trash size={12}/>
                                                            </button>
                                                        )}
                                                    </div>
                                                ))}
                                            </div>
                                            <div onClick={createWorkspace} className="p-2 border-t border-zinc-100 hover:bg-zinc-50 cursor-pointer flex items-center gap-2 text-sm text-zinc-600">
                                                <PlusCircle size={14}/> <span>Crear Workspace</span>
                                            </div>
                                        </motion.div>
                                    </>
                                )}
                            </AnimatePresence>
                        </div>

                        <div className="flex-1 overflow-y-auto px-2 space-y-0.5 fancy-scroll">
                            {[{ icon: Search, label: 'Buscar', action: () => setShowSearch(true) }, { icon: SidebarIcon, label: 'Inicio', action: () => { setCurrentView('home'); setActivePageId(null); } }, { icon: Inbox, label: 'Bandeja', action: () => {} }].map((item, i) => (
                                <div key={i} onClick={item.action} className={`flex items-center gap-3 p-1.5 rounded-md hover:bg-[#EFEFEE] text-zinc-600 cursor-pointer ${!sidebarOpen ? 'justify-start pl-1' : ''}`}><item.icon size={18} className="shrink-0" />{sidebarOpen && <span className="text-sm font-medium">{item.label}</span>}</div>
                            ))}
                            <div onClick={() => setShowAI(true)} className={`flex items-center gap-3 p-1.5 rounded-md hover:bg-[#EFEFEE] text-zinc-600 cursor-pointer ${!sidebarOpen ? 'justify-start pl-1' : ''}`}><Sparkles size={18} className="shrink-0 text-yellow-600" /> {sidebarOpen && <span className="text-sm font-medium">IA Notion</span>}</div>
                            {isAiGeneratingBackground && <div className={`mt-2 mb-2 p-1.5 bg-white border border-zinc-200 rounded-md shadow-sm flex items-center gap-3 animate-pulse ${!sidebarOpen ? 'justify-center mx-0' : 'mx-2'}`}><Loader2 size={14} className="animate-spin text-indigo-500 shrink-0"/>{sidebarOpen && <span className="text-xs text-zinc-500 font-medium">Generando...</span>}</div>}
                            
                            <div className="mt-6 mb-1 px-2 flex justify-between items-center group/header">{sidebarOpen && <span className="text-xs font-semibold text-zinc-500">PRIVADO</span>}{sidebarOpen && <button onClick={(e) => { e.stopPropagation(); createPage(); }} className="text-zinc-400 hover:text-zinc-600 opacity-0 group-hover/header:opacity-100 transition-opacity"><Plus size={14}/></button>}</div>
                            
                            {workspace.pages.length === 0 && sidebarOpen && (
                                <div className="text-xs text-zinc-400 px-2 mt-2 italic">Sin p√°ginas</div>
                            )}

                            {workspace.pages.map(page => (
                                <div key={page.id} onClick={() => { setActivePageId(page.id); setCurrentView('page'); }} className={`flex items-center gap-3 p-1.5 rounded-md hover:bg-[#EFEFEE] cursor-pointer group ${!sidebarOpen ? 'justify-start pl-1' : ''} ${activePageId === page.id ? 'bg-[#EFEFEE] font-medium text-zinc-900' : 'text-zinc-600'}`}><span className="text-lg leading-none w-4 text-center shrink-0">{page.icon || <FileText size={16} />}</span>{sidebarOpen && <span className="text-sm truncate opacity-90">{page.title || 'Sin t√≠tulo'}</span>}</div>
                            ))}
                        </div>
                        <div className="p-2 border-t border-[#E9E9E8] space-y-0.5">
                            <div onClick={() => { setCurrentView('settings'); setSettingsTab('menu'); }} className={`flex items-center gap-3 p-1.5 rounded-md hover:bg-[#EFEFEE] text-zinc-600 cursor-pointer ${!sidebarOpen ? 'justify-start pl-1' : ''}`}><Settings size={18} className="shrink-0" /> {sidebarOpen && <span className="text-sm">Configuraci√≥n</span>}</div>
                            <div onClick={() => { setShowMarket(true); setMarketTab('galer√≠a'); }} className={`flex items-center gap-3 p-1.5 rounded-md hover:bg-[#EFEFEE] text-zinc-600 cursor-pointer ${!sidebarOpen ? 'justify-start pl-1' : ''}`}><Palette size={18} className="shrink-0" /> {sidebarOpen && <span className="text-sm">Marketplace</span>}</div>
                            <div onClick={() => setCurrentView('trash')} className={`flex items-center gap-3 p-1.5 rounded-md hover:bg-[#EFEFEE] text-zinc-600 cursor-pointer ${!sidebarOpen ? 'justify-start pl-1' : ''}`}><Trash size={18} className="shrink-0" /> {sidebarOpen && <span className="text-sm">Papelera</span>}</div>
                            <div onClick={() => setSidebarOpen(!sidebarOpen)} className={`flex items-center gap-3 p-1.5 rounded-md hover:bg-[#EFEFEE] text-zinc-500 cursor-pointer mt-2 ${!sidebarOpen ? 'justify-start pl-1' : ''}`}><ChevronsLeft size={18} className={`shrink-0 transition-transform ${!sidebarOpen ? "rotate-180" : ""}`} /> {sidebarOpen && <span className="text-sm">Cerrar barra</span>}</div>
                        </div>
                    </motion.aside>

                    <main className="flex-1 h-full overflow-hidden relative flex flex-col bg-white">
                        <header className="h-12 flex items-center justify-between px-4 shrink-0 hover:bg-[#FBFBFA] transition-colors z-10 sticky top-0 bg-white/80 backdrop-blur-sm">
                            <div className="flex items-center gap-2 text-sm text-zinc-600 overflow-hidden w-full">
                                {!sidebarOpen && <button onClick={() => setSidebarOpen(true)} className="p-1 hover:bg-zinc-100 rounded mr-2"><List size={18}/></button>}
                                {currentView === 'home' ? <div className="flex items-center gap-2"><Briefcase size={16}/><span>Inicio</span></div> : currentView === 'settings' ? <div className="flex items-center gap-2"><Settings size={16}/><span>Configuraci√≥n</span></div> : currentView === 'trash' ? <span>Papelera</span> : <div className="flex items-center gap-2 overflow-hidden w-full"><span className="text-lg">{activePage?.icon || <FileText size={16} />}</span><span className="text-zinc-800 truncate font-medium">{activePage?.title || 'Sin t√≠tulo'}</span></div>}
                            </div>
                            {currentView === 'page' && <div className="relative ml-2"><button onClick={() => setShowPageOptions(!showPageOptions)} className="p-1 text-zinc-500 hover:bg-zinc-100 rounded transition-colors"><MoreHorizontal size={20} /></button><AnimatePresence>{showPageOptions && <motion.div initial={{opacity:0, scale:0.95}} animate={{opacity:1, scale:1}} exit={{opacity:0, scale:0.95}} className="absolute right-0 top-8 w-56 bg-white border border-zinc-200 rounded-lg shadow-xl z-50 overflow-hidden py-1"><button onClick={() => { deletePage(activePageId); setShowPageOptions(false); }} className="w-full text-left flex items-center gap-2 px-3 py-1.5 text-red-600 hover:bg-red-50 cursor-pointer text-sm"><Trash size={14}/> Eliminar</button></motion.div>}</AnimatePresence></div>}
                        </header>

                        <div className="flex-1 overflow-y-auto p-0 relative fancy-scroll">
                            {currentView === 'home' && (
                                <div className="max-w-4xl mx-auto h-full flex flex-col p-8 md:p-12 text-center animate-in fade-in duration-500">
                                    <div className="mb-8 flex justify-center">
                                        <div className="w-24 h-24 rounded-full overflow-hidden border-2 border-zinc-200 shadow-md">
                                            {userProfile.avatar ? <img src={userProfile.avatar} className="w-full h-full object-cover"/> : <div className="w-full h-full bg-zinc-100 flex items-center justify-center text-3xl">{workspace.initial}</div>}
                                        </div>
                                    </div>
                                    <h1 className="text-3xl font-bold mb-2 text-zinc-800">Hola, {userProfile.name}</h1>
                                    <p className="text-zinc-500">Est√°s en <strong>{workspace.name}</strong>.</p>
                                </div>
                            )}
                            
                            {currentView === 'settings' && (
                                <div className="max-w-3xl mx-auto py-12 px-6 animate-in slide-in-from-bottom-4 fade-in duration-300">
                                    {settingsTab === 'menu' && (
                                        <>
                                            <h1 className="text-2xl font-bold mb-8 text-zinc-800">Configuraci√≥n</h1>
                                            <div className="bg-white border border-zinc-200 rounded-xl overflow-hidden shadow-sm">
                                                <div onClick={() => setSettingsTab('account')} className="p-4 hover:bg-zinc-50 cursor-pointer flex justify-between items-center border-b border-zinc-100"><div className="flex items-center gap-4"><div className="w-10 h-10 bg-zinc-100 rounded-full flex items-center justify-center overflow-hidden">{userProfile.avatar ? <img src={userProfile.avatar} className="w-full h-full object-cover"/> : <User size={20}/>}</div><div><div className="font-medium text-sm">Mi Perfil</div><div className="text-xs text-zinc-500">Personalizar datos</div></div></div><ChevronRight size={16} className="text-zinc-400"/></div>
                                                <div onClick={() => setSettingsTab('appearance')} className="p-4 hover:bg-zinc-50 cursor-pointer flex justify-between items-center border-b border-zinc-100"><div className="flex items-center gap-4"><div className="w-8 h-8 bg-blue-50 text-blue-500 rounded flex items-center justify-center"><Palette size={16}/></div><div><div className="font-medium text-sm">Apariencia</div><div className="text-xs text-zinc-500">Temas importados</div></div></div><ChevronRight size={16} className="text-zinc-400"/></div>
                                                <div onClick={() => setSettingsTab('fonts')} className="p-4 hover:bg-zinc-50 cursor-pointer flex justify-between items-center"><div className="flex items-center gap-4"><div className="w-8 h-8 bg-pink-50 text-pink-500 rounded flex items-center justify-center"><Type size={16}/></div><div><div className="font-medium text-sm">Tipograf√≠a</div><div className="text-xs text-zinc-500">Fuentes del mercado</div></div></div><ChevronRight size={16} className="text-zinc-400"/></div>
                                            </div>
                                        </>
                                    )}
                                    
                                    {settingsTab === 'account' && (
                                        <>
                                            <button onClick={() => setSettingsTab('menu')} className="flex items-center gap-1 text-zinc-500 mb-6 text-sm hover:text-zinc-800"><ArrowLeft size={14}/> Volver</button>
                                            <h2 className="text-xl font-bold mb-6 pb-4 border-b border-zinc-100">Mi Perfil</h2>
                                            
                                            <div className="flex gap-6 mb-8 items-start">
                                                <div className="relative group cursor-pointer" onClick={() => triggerUpload('avatar')}>
                                                    <div className="w-24 h-24 bg-zinc-100 rounded-full flex items-center justify-center text-zinc-300 border-4 border-white shadow-lg overflow-hidden">
                                                        {userProfile.avatar ? <img src={userProfile.avatar} className="w-full h-full object-cover"/> : <User size={40}/>}
                                                    </div>
                                                    <div className="absolute inset-0 bg-black/40 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity text-white text-xs font-bold gap-1">
                                                        <Camera size={14}/> Cambiar
                                                    </div>
                                                </div>
                                                
                                                <div className="flex-1 space-y-4">
                                                    <div>
                                                        <label className="text-xs font-bold text-zinc-500 uppercase block mb-1">Nombre</label>
                                                        <input 
                                                            className="w-full p-2 border border-zinc-200 rounded-md text-sm focus:border-indigo-500 outline-none transition-colors" 
                                                            value={userProfile.name}
                                                            onChange={(e) => setUserProfile({...userProfile, name: e.target.value})}
                                                        />
                                                    </div>
                                                    <div>
                                                        <label className="text-xs font-bold text-zinc-500 uppercase block mb-1">Bio / Descripci√≥n</label>
                                                        <textarea 
                                                            className="w-full p-2 border border-zinc-200 rounded-md text-sm focus:border-indigo-500 outline-none resize-none h-20 transition-colors" 
                                                            value={userProfile.bio}
                                                            onChange={(e) => setUserProfile({...userProfile, bio: e.target.value})}
                                                            placeholder="Escribe algo sobre ti..."
                                                        />
                                                    </div>
                                                    <div>
                                                        <label className="text-xs font-bold text-zinc-500 uppercase block mb-1">Email</label>
                                                        <input className="w-full p-2 border border-zinc-200 rounded-md text-sm bg-zinc-50 text-zinc-400 cursor-not-allowed" value={userProfile.email} disabled/>
                                                    </div>
                                                </div>
                                            </div>
                                        </>
                                    )}

                                    {settingsTab === 'appearance' && (
                                        <>
                                            <button onClick={() => setSettingsTab('menu')} className="flex items-center gap-1 text-zinc-500 mb-6 text-sm hover:text-zinc-800"><ArrowLeft size={14}/> Volver</button>
                                            <h2 className="text-xl font-bold mb-4">Mis Temas</h2>
                                            {importedResources.styles.length === 0 ? <div className="text-center p-8 border-2 border-dashed rounded-xl text-zinc-400 text-sm">No has importado temas del Marketplace a√∫n.</div> : (
                                                <div className="grid gap-3">{importedResources.styles.map((s, i) => (<div key={i} className="bg-white p-3 border rounded-lg flex justify-between items-center"><div className="font-medium text-sm">{s.name}</div><button className="text-xs bg-zinc-900 text-white px-3 py-1.5 rounded">Aplicar</button></div>))}</div>
                                            )}
                                        </>
                                    )}
                                    
                                    {settingsTab === 'fonts' && (
                                        <>
                                            <button onClick={() => setSettingsTab('menu')} className="flex items-center gap-1 text-zinc-500 mb-6 text-sm hover:text-zinc-800"><ArrowLeft size={14}/> Volver</button>
                                            <h2 className="text-xl font-bold mb-4">Mis Fuentes</h2>
                                            {importedResources.fonts.length === 0 ? (
                                                <div className="text-center p-8 border-2 border-dashed rounded-xl text-zinc-400 text-sm"><div className="mb-2">üî§</div>No hay fuentes instaladas.<br/>Visita el Marketplace para obtener alguna.</div>
                                            ) : (
                                                <div className="grid gap-3">{importedResources.fonts.map((f, i) => (<div key={i} className="bg-white p-3 border rounded-lg flex justify-between items-center"><div className="font-medium text-sm font-mono">{f.name}</div><button className="text-xs bg-zinc-900 text-white px-3 py-1.5 rounded">Usar</button></div>))}</div>
                                            )}
                                        </>
                                    )}
                                </div>
                            )}

                            {currentView === 'page' && activePage && (
                                <motion.div key={activePage.id} initial={{ opacity: 0 }} animate={{ opacity: 1 }} className="max-w-3xl mx-auto pb-48">
                                    <div className="group/cover relative w-full h-48 md:h-72 bg-zinc-50 border-b border-zinc-100">
                                        {activePage.cover ? (<img src={activePage.cover} className="w-full h-full object-cover"/>) : (<div className="w-full h-full opacity-0 group-hover/cover:opacity-100 transition-opacity flex items-center justify-center text-sm text-zinc-400 cursor-pointer" onClick={() => { setMarketTab('galer√≠a'); setShowMarket(true); }}>A√±adir portada</div>)}
                                        <button onClick={() => { setMarketTab('galer√≠a'); setShowMarket(true); }} className="absolute bottom-4 right-4 bg-white/80 hover:bg-white text-xs px-2 py-1 rounded shadow-sm text-zinc-600 border border-zinc-200 opacity-0 group-hover/cover:opacity-100 transition-opacity">Cambiar portada</button>
                                    </div>
                                    <div className="px-8 md:px-24">
                                        <div className="relative -mt-10 mb-8 z-10 group/icon"><div onClick={() => setShowIconPicker(!showIconPicker)} className="text-7xl cursor-pointer hover:scale-105 transition-transform inline-block relative">{activePage.icon || 'üìÑ'}</div>{showIconPicker && (<div className="absolute top-full left-0 z-50 bg-white border border-zinc-200 p-3 rounded-xl shadow-xl w-64 grid grid-cols-6 gap-2 h-48 overflow-y-auto mt-2">{ICONS_LIST.map(icon => <div key={icon} onClick={() => { updatePage(activePageId, { icon }); setShowIconPicker(false); }} className="text-xl p-1 hover:bg-zinc-100 rounded cursor-pointer text-center">{icon}</div>)}</div>)}</div>
                                        <input value={activePage.title} onChange={(e) => updatePage(activePage.id, { title: e.target.value })} placeholder="T√≠tulo de la p√°gina" className="w-full text-4xl font-bold text-[#37352f] placeholder:text-zinc-300 border-none outline-none bg-transparent mb-8" />
                                        <div className="space-y-0.5 min-h-[300px]">{activePage.blocks.map((block, index) => (<EditorBlock key={block.id} block={block} index={index} updateBlock={updateBlock} addBlock={addBlock} deleteBlock={deleteBlock} />))}</div>
                                        <div className="h-32 -mx-4 cursor-text mt-4 opacity-0 hover:opacity-100 transition-opacity flex items-start pt-2 px-4 text-zinc-300 text-sm" onClick={() => addBlock(activePage.blocks.length)}>Haz clic para escribir...</div>
                                    </div>
                                </motion.div>
                            )}
                        </div>
                    </main>

                    {/* MODALES IGUALES QUE ANTES... (Search, AI, Market) */}
                    <Modal isOpen={showSearch} onClose={() => setShowSearch(false)} title={null}><div className="p-4 border-b border-zinc-100 bg-[#FBFBFA]"><div className="flex items-center gap-3 bg-white px-3 py-3 rounded-lg border border-zinc-200 shadow-sm focus-within:ring-2 ring-indigo-500/20"><Search className="text-zinc-400" size={18} /><input autoFocus value={searchQuery} onChange={e => setSearchQuery(e.target.value)} placeholder="Busca en tus p√°ginas..." className="bg-transparent w-full outline-none text-base placeholder:text-zinc-400 text-zinc-700" /></div></div><div className="p-2 min-h-[300px]">{filteredPages.length > 0 ? filteredPages.map(p => (<div key={p.id} onClick={() => { setActivePageId(p.id); setCurrentView('page'); setShowSearch(false); }} className="flex items-center gap-3 p-2 hover:bg-zinc-100 rounded cursor-pointer group"><div className="text-xl">{p.icon || 'üìÑ'}</div><div className="flex-1"><div className="text-sm font-medium text-zinc-800">{p.title || 'Sin t√≠tulo'}</div><div className="text-xs text-zinc-400">En {workspace.name}</div></div><ArrowRight size={14} className="text-zinc-300 opacity-0 group-hover:opacity-100"/></div>)) : <div className="text-center text-zinc-400 mt-12 text-sm">No se encontraron resultados</div>}</div></Modal>
                    <Modal isOpen={showAI} onClose={() => setShowAI(false)} title={null} transparent={true}><div className="flex items-center justify-center h-full p-4"><motion.div initial={{ scale: 0.9, opacity: 0 }} animate={{ scale: 1, opacity: 1 }} className="bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden border border-zinc-200"><div className="p-6 bg-gradient-to-br from-indigo-50 to-white"><h2 className="text-lg font-bold text-zinc-800 mb-2 flex items-center gap-2"><Sparkles size={18} className="text-indigo-500"/> Notion AI</h2><p className="text-sm text-zinc-500 mb-4">Describe lo que necesitas. La p√°gina se generar√° en segundo plano.</p><textarea autoFocus value={aiPrompt} onChange={e => setAiPrompt(e.target.value)} placeholder="Ej: Rutina de gimnasio para 3 d√≠as..." className="w-full bg-white border border-zinc-200 rounded-xl p-4 h-32 resize-none outline-none focus:border-indigo-500 focus:ring-4 focus:ring-indigo-500/10 mb-4 text-zinc-700 text-sm"/><div className="flex justify-end gap-2"><button onClick={() => setShowAI(false)} className="px-4 py-2 rounded-lg text-zinc-500 hover:bg-zinc-100 text-sm font-medium">Cancelar</button><button onClick={generatePageWithAI} disabled={!aiPrompt.trim()} className="px-4 py-2 rounded-lg bg-zinc-900 text-white font-medium text-sm hover:bg-black transition-colors disabled:opacity-50 flex items-center gap-2">Generar P√°gina</button></div></div></motion.div></div></Modal>
                    
                    <Modal isOpen={showMarket} onClose={() => setShowMarket(false)} title={null} size="max-w-4xl">
                        <div className="flex flex-col h-full bg-[#FBFBFA]">
                            <div className="flex justify-between items-center px-6 pt-6 pb-2"><div className="flex gap-6 text-sm font-medium">{['Galer√≠a', 'Estilos', 'Fuentes'].map(tab => (<button key={tab} onClick={() => setMarketTab(tab.toLowerCase())} className={`pb-2 px-1 transition-colors relative ${marketTab === tab.toLowerCase() ? 'text-zinc-900 border-b-2 border-zinc-900' : 'text-zinc-500 hover:text-zinc-800'}`}>{tab}</button>))}</div><button onClick={() => setShowMarket(false)} className="text-zinc-400 hover:text-zinc-600"><X size={20}/></button></div><div className="h-px bg-zinc-200 mx-6 mb-6"/>
                            <div className="flex-1 overflow-y-auto px-6 pb-6 min-h-[400px]">
                                {isLoadingMarket ? (<div className="flex flex-col items-center justify-center h-full text-zinc-400 gap-3"><Loader2 className="animate-spin text-zinc-300" size={32}/><span>Conectando...</span></div>) : (
                                    <>
                                        {marketTab === 'galer√≠a' && (<><div className="flex justify-between items-center mb-4"><h3 className="text-xs font-bold text-zinc-400 uppercase">Disponibles en la nube</h3><button onClick={() => triggerUpload('cover')} className="text-xs flex items-center gap-1 bg-zinc-100 hover:bg-zinc-200 px-2 py-1 rounded text-zinc-600"><UploadCloud size={12}/> Subir Propia</button></div><div className="grid grid-cols-2 md:grid-cols-4 gap-4">{marketData.covers.length === 0 ? <div className="col-span-full text-center text-zinc-400 text-sm py-12">No se encontraron portadas online.</div> : marketData.covers.map((url, i) => (<div key={i} onClick={() => { updatePage(activePageId, { cover: url }); setShowMarket(false); }} className="h-28 rounded-lg overflow-hidden cursor-pointer hover:ring-2 ring-indigo-500 transition-all shadow-sm group relative"><img src={url} className="w-full h-full object-cover"/><div className="absolute inset-0 bg-black/10 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center text-white text-xs font-bold">Usar</div></div>))}</div></>)}
                                        {marketTab === 'estilos' && (<><div className="flex justify-end mb-4"><button onClick={() => triggerUpload('style')} className="text-xs flex items-center gap-1 bg-zinc-100 hover:bg-zinc-200 px-2 py-1 rounded text-zinc-600"><FolderOpen size={12}/> Cargar JSON</button></div><div className="grid grid-cols-1 md:grid-cols-2 gap-4">{marketData.styles.map(s => (<div key={s.id} className="bg-white rounded-xl border border-zinc-200 p-4 flex gap-4 hover:shadow-md transition-shadow"><div className={`w-16 h-16 rounded-lg ${s.color || 'bg-zinc-100'} flex items-center justify-center text-2xl font-bold opacity-50`}>Aa</div><div className="flex-1"><div className="font-bold text-zinc-800">{s.name}</div><div className="text-xs text-zinc-500 mb-3">Por {s.author}</div><button onClick={() => importResource(s, 'style')} disabled={installedIds.has(s.id)} className={`px-3 py-1.5 rounded-md text-xs font-medium w-full ${installedIds.has(s.id) ? 'bg-zinc-100 text-zinc-400 cursor-default' : 'bg-zinc-900 text-white hover:bg-black'}`}>{installedIds.has(s.id) ? 'Instalado' : 'Obtener'}</button></div></div>))}</div></>)}
                                        {marketTab === 'fuentes' && (<><div className="flex justify-end mb-4"><button onClick={() => triggerUpload('font')} className="text-xs flex items-center gap-1 bg-zinc-100 hover:bg-zinc-200 px-2 py-1 rounded text-zinc-600"><UploadCloud size={12}/> Subir Fuente</button></div><div className="space-y-2">{marketData.fonts.map(f => (<div key={f.id} className="flex justify-between items-center p-3 bg-white border border-zinc-200 rounded-lg"><div><div className="font-bold text-zinc-800">{f.name}</div><div className="text-xs text-zinc-400">Open Source License</div></div><button onClick={() => importResource(f, 'font')} disabled={installedIds.has(f.id)} className={`text-xs font-bold px-3 py-1.5 rounded ${installedIds.has(f.id) ? 'text-zinc-400 cursor-default' : 'text-indigo-600 hover:bg-indigo-50'}`}>{installedIds.has(f.id) ? 'Instalado' : 'Instalar'}</button></div>))}</div></>)}
                                    </>
                                )}
                            </div>
                        </div>
                    </Modal>
                </div>
            );
        }

        const container = document.getElementById('root');
        if (container) {
            const root = createRoot(container);
            root.render(<App />);
        }
    </script>
</body>
</html>